---
title: "Task2"
author: "Danila Valko"
date: "08 07 2021"
output: 
  html_document:
    keep_md: true
---



# Распилы льда


```r
load_data <- function (filename = "data.xlsx"){
  sheets <- readxl::excel_sheets(filename)
  data <- NULL
  for (s in sheets){
    d <- read_excel(filename, sheet = s)
    names(d)[4:9] <- d[1, 4:9]
    d <- d[-1,-11]
    d$Year <- s
    data <- rbind(data,d)
  }
  data
}
```

### Подгрузим данные


```r
data <- load_data()
```

```
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
## New names:
## * `` -> ...5
## * `` -> ...6
## * `` -> ...7
## * `` -> ...8
## * `` -> ...9
## * ...
```

```r
head(data, 3)
```

```
## # A tibble: 3 x 11
##   Расположение Тип   `Наименование м~ `Широта, Градус~ `Широта, Минут`
##   <chr>        <chr> <chr>            <chr>            <chr>          
## 1 Ленск        СУБВ  Ослабление проч~ 61               22             
## 2 Ленск        СУБВ  Определение гра~ 35               43             
## 3 Якутск       СУБВ  Определение гра~ 62               1              
## # ... with 6 more variables: `Широта, Секунд` <chr>, `Долгота, Градусов` <chr>,
## #   `Долгота, Минут` <chr>, `Долгота, Секунд` <chr>, `Влияние на водный
## #   объект` <chr>, Year <chr>
```

```r
tail(data, 3)
```

```
## # A tibble: 3 x 11
##   Расположение Тип   `Наименование м~ `Широта, Градус~ `Широта, Минут`
##   <chr>        <chr> <chr>            <chr>            <chr>          
## 1 Якутск       СУБВ  Определение мес~ 62               27             
## 2 Якутск       СУБВ  Расчистка Атлас~ 61               58             
## 3 Олекминск    СУБВ  Определение мес~ 71               57             
## # ... with 6 more variables: `Широта, Секунд` <chr>, `Долгота, Градусов` <chr>,
## #   `Долгота, Минут` <chr>, `Долгота, Секунд` <chr>, `Влияние на водный
## #   объект` <chr>, Year <chr>
```

### Сверим количество записей по годам


```r
print(paste("Year     l:",length(data$Year),"lu:",length(unique(data$Year))))
```

```
## [1] "Year     l: 110 lu: 10"
```

```r
summary(factor(data$Year))
```

```
## 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 
##   12   15    8    7   13   15   13   12    7    8
```

Всё в порядке.

### Поищем уникальные значения и повторы в основных текстовых полях

Вообще для автоматизированного поиска опечаток здесь имело бы смысл написать скрипт, который бы вывел список наименований, отличающихся друг от друга не более чем на три символа. Допустим по расстоянию Левенштейна. Но данных не много, можно и глазами.


```r
summary(factor(data[,1]))[1]
```

```
## c("Ленск", "Якутск", "Покровск", "Олёкминск", "Саха (Якутия)", "Якутстк", "Олекминск", "Сангар", "г. Киренск", "Саха Якутия") 
##                                                                                                                             0
```

```r
summary(factor(data[,2]))[1]
```

```
## c("СУБВ", "ГТС") 
##                0
```

```r
summary(factor(data[,10]))[1]
```

```
## c("Ослабление прочности льда", "Нет влияния", NA) 
##                                                 0
```


Замечаем ошибки и разночтения в наименовании городов ("Якутск" -> "Якутстк"), ("Саха Якутия" -> "Саха (Якутия)") и др. В поле "Влияние на водный объект" видим пустые ячейки - смыслу не противоречит, там некоторая "расчистка", а не замер.

### Поищем нечисловые знаки в числовых полях

Грубовато, конечно..


```r
d <- data[,4:9]
d <- unique(unlist(list(d)))
ifelse(is.na(as.numeric(d)), d, "")
```

```
##  [1] ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""  
## [16] ""   "НД" ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""  
## [31] ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""  
## [46] ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""  
## [61] ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""   ""
```

Видим штуковину "НД" - это по всей видимости закодировано отсутствующее значение. Прочих подозрительных вещей не видим.

## Общие замечания и предложения (110 obs. x 11 vars.)

* Ограничения на широту и долготу надо проверять и, возможно, ввести их в заполняемую эксель-форму.
* Опечатки в топонимах неизбежны при ручном вводе. Классификатор бы помог их побороть и нормализация.
* Стоит разбить поле "Наименование мероприятия" при вводе, вынести из него топонимы и типы мероприятий в отдельные колонки. Это и контроль облегчило бы и потворяющиеся локации эксель будет подсказывать. Там же систематическая проблема с лишними/недостающими пробелами - в принципе, может решаться шаблонами.
* Нужен фильтр на неалфавитные символы типа "#" и др. Можно их автоматически чистить.
* Нужно оговорить все форматы записи "отсутствующих" значений.
  
  
  

.
