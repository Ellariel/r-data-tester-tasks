---
title: "Task2"
author: "Danila Valko"
date: "08 07 2021"
output: 
  html_document:
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
```

# Распилы льда

```{r tidy_data, warning=FALSE}
load_data <- function (filename = "data.xlsx"){
  sheets <- readxl::excel_sheets(filename)
  data <- NULL
  for (s in sheets){
    d <- read_excel(filename, sheet = s)
    names(d)[4:9] <- d[1, 4:9]
    d <- d[-1,-11]
    d$Year <- s
    data <- rbind(data,d)
  }
  data
}
  
```

### Подгрузим данные

```{r data-load, warning=FALSE}
data <- load_data()
head(data, 3)
tail(data, 3)
```

### Сверим количество записей по годам

```{r }
print(paste("Year     l:",length(data$Year),"lu:",length(unique(data$Year))))
summary(factor(data$Year))
```

Всё в порядке.

### Поищем уникальные значения и повторы в основных текстовых полях

Вообще для автоматизированного поиска опечаток здесь имело бы смысл написать скрипт, который бы вывел список наименований, отличающихся друг от друга не более чем на три символа. Допустим по расстоянию Левенштейна. Но данных не много, можно и глазами.

```{r }
summary(factor(data[,1]))[1]
summary(factor(data[,2]))[1]
summary(factor(data[,10]))[1]
```


Замечаем ошибки и разночтения в наименовании городов ("Якутск" -> "Якутстк"), ("Саха Якутия" -> "Саха (Якутия)") и др. В поле "Влияние на водный объект" видим пустые ячейки - смыслу не противоречит, там некоторая "расчистка", а не замер.

### Поищем нечисловые знаки в числовых полях

Грубовато, конечно..

```{r, warning=FALSE}
d <- data[,4:9]
d <- unique(unlist(list(d)))
ifelse(is.na(as.numeric(d)), d, "")
```

Видим штуковину "НД" - это по всей видимости закодировано отсутствующее значение. Прочих подозрительных вещей не видим.

## Общие замечания и предложения (110 obs. x 11 vars.)

* Ограничения на широту и долготу надо проверять и, возможно, ввести их в заполняемую эксель-форму.
* Опечатки в топонимах неизбежны при ручном вводе. Классификатор бы помог их побороть и нормализация.
* Стоит разбить поле "Наименование мероприятия" при вводе, вынести из него топонимы и типы мероприятий в отдельные колонки. Это и контроль облегчило бы и потворяющиеся локации эксель будет подсказывать. Там же систематическая проблема с лишними/недостающими пробелами - в принципе, может решаться шаблонами.
* Нужен фильтр на неалфавитные символы типа "#" и др. Можно их автоматически чистить.
* Нужно оговорить все форматы записи "отсутствующих" значений.
  
  
  

.